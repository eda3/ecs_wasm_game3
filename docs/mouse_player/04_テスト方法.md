# マウスカーソル表示機能 テスト方法

## 1. テスト概要

マウスカーソル表示機能のテストは、以下の観点から行います。

1. 機能テスト: 機能要件が正しく実装されているか
2. パフォーマンステスト: 性能要件を満たしているか
3. ネットワークテスト: マルチプレイヤー環境で正しく動作するか
4. ユーザビリティテスト: ユーザー体験は良好か

## 2. 機能テストの方法

### 2.1 ローカルプレイヤーのマウスカーソル表示テスト

| テストID | TC-MC-001 |
|--------|--------|
| テスト名 | ローカルマウスカーソル表示 |
| 目的 | マウスカーソル位置に赤い円が描画されることを確認 |
| 前提条件 | ゲームが起動し、プレイ画面が表示されている |
| 手順 | 1. マウスを画面上で移動させる<br>2. マウスカーソルの動きを観察する |
| 期待結果 | 1. マウスカーソル位置に赤い円（直径20px）が表示される<br>2. 円はマウスの動きに追従する<br>3. 円は半透明（50%）で表示される |

### 2.2 マウスカーソル情報のネットワーク同期テスト

| テストID | TC-MC-002 |
|--------|--------|
| テスト名 | マウスカーソル情報のネットワーク同期 |
| 目的 | マウスカーソル位置が他のプレイヤーに正しく同期されることを確認 |
| 前提条件 | 2人以上のプレイヤーがマルチプレイヤーセッションに参加している |
| 手順 | 1. プレイヤーAがマウスを画面上で移動させる<br>2. プレイヤーBの画面でプレイヤーAのカーソル位置を観察する |
| 期待結果 | 1. プレイヤーBの画面上に、プレイヤーAのマウスカーソル位置が表示される<br>2. 表示には多少の遅延があるが、全体的な動きは追従している |

### 2.3 他プレイヤーのマウスカーソル表示テスト

| テストID | TC-MC-003 |
|--------|--------|
| テスト名 | 他プレイヤーのマウスカーソル表示 |
| 目的 | 他プレイヤーのマウスカーソルが適切に表示されることを確認 |
| 前提条件 | 複数のプレイヤーがマルチプレイヤーセッションに参加している |
| 手順 | 1. 複数のプレイヤーが同時に接続する<br>2. それぞれのプレイヤーがマウスを動かす |
| 期待結果 | 1. 各プレイヤーの画面に、他のプレイヤーのマウスカーソルが表示される<br>2. 各プレイヤーのカーソルは異なる色で表示される<br>3. カーソルの横にプレイヤー名が小さく表示される |

## 3. パフォーマンステスト

### 3.1 フレームレート測定

| テストID | TC-MC-P01 |
|--------|--------|
| テスト名 | マウスカーソル表示のフレームレート影響測定 |
| 目的 | マウスカーソル表示がゲームのフレームレートに与える影響を測定 |
| 前提条件 | FPS測定モードが有効になっている |
| 手順 | 1. マウスカーソル表示機能を無効にした状態でFPSを測定（ベースライン）<br>2. マウスカーソル表示機能を有効にした状態でFPSを測定<br>3. 10人分のカーソルを同時に表示した状態でFPSを測定 |
| 期待結果 | 1. ベースラインと比較して、1人のカーソル表示時のFPS低下が5%未満<br>2. 10人のカーソル表示時のFPS低下が10%未満 |

### 3.2 ネットワーク帯域使用量測定

| テストID | TC-MC-P02 |
|--------|--------|
| テスト名 | マウスカーソル同期の帯域使用量測定 |
| 目的 | マウスカーソル同期が使用するネットワーク帯域を測定 |
| 前提条件 | ネットワークトラフィック測定ツールが設定されている |
| 手順 | 1. マウスをランダムに動かし続ける<br>2. 1分間のカーソル位置更新メッセージの総バイト数を測定 |
| 期待結果 | 1. 1分間の帯域使用量が20KB未満<br>2. 1回のカーソル更新メッセージが50バイト未満 |

## 4. ユーザビリティテスト

### 4.1 ユーザー感覚評価

| テストID | TC-MC-U01 |
|--------|--------|
| テスト名 | マウスカーソル表示のユーザビリティ評価 |
| 目的 | マウスカーソル表示機能の使いやすさを評価 |
| 前提条件 | テストユーザーがゲームにアクセスできる環境がある |
| 手順 | 1. テストユーザーにゲームプレイを依頼<br>2. 以下の質問に答えてもらう:<br>- カーソルの視認性は良好か<br>- 他プレイヤーのカーソルは識別しやすいか<br>- カーソル表示が邪魔に感じるか<br>- カーソル表示の有無で遊びやすさに違いを感じるか |
| 期待結果 | 1. カーソルの視認性が「良好」または「非常に良好」と評価される<br>2. 他プレイヤーのカーソルが「識別しやすい」と評価される<br>3. カーソル表示が「邪魔ではない」と評価される |

### 4.2 設定オプションのテスト

| テストID | TC-MC-U02 |
|--------|--------|
| テスト名 | マウスカーソル表示設定オプションのテスト |
| 目的 | マウスカーソル表示の設定オプションが正しく動作することを確認 |
| 前提条件 | ゲーム設定画面にアクセスできる |
| 手順 | 1. 設定画面を開く<br>2. マウスカーソル表示のON/OFFを切り替える<br>3. ゲーム画面に戻り、効果を確認する |
| 期待結果 | 1. 設定をOFFにすると、自分のカーソルが表示されなくなる<br>2. 設定をOFFにすると、他プレイヤーに自分のカーソルが送信されなくなる<br>3. 設定をONに戻すと、カーソル表示と送信が再開される |

## 5. エッジケーステスト

### 5.1 多数のプレイヤーテスト

| テストID | TC-MC-E01 |
|--------|--------|
| テスト名 | 多数プレイヤーのカーソル表示テスト |
| 目的 | 多数のプレイヤーが同時に接続した場合のカーソル表示を確認 |
| 前提条件 | 20人以上のプレイヤーが同時に接続できる環境がある |
| 手順 | 1. 20人以上のプレイヤーを同時に接続させる<br>2. 全員がマウスを動かす<br>3. カーソル表示とゲームのパフォーマンスを観察する |
| 期待結果 | 1. 全プレイヤーのカーソルが表示される<br>2. フレームレートが30FPS以上維持される<br>3. 遅延が許容範囲内（200ms未満）である |

### 5.2 ネットワーク不良環境テスト

| テストID | TC-MC-E02 |
|--------|--------|
| テスト名 | ネットワーク不良環境下でのカーソル表示テスト |
| 目的 | ネットワーク状態が悪い場合のカーソル表示の挙動を確認 |
| 前提条件 | ネットワーク状態をエミュレートできる環境がある |
| 手順 | 1. ネットワーク遅延を200ms/400ms/600msに設定<br>2. パケットロスを5%/10%/20%に設定<br>3. それぞれの条件でカーソル表示の挙動を観察 |
| 期待結果 | 1. 遅延が増えると、カーソル位置の更新が遅れるが、動きは滑らかさを保つ<br>2. パケットロスが増えても、極端な位置ジャンプが発生しない<br>3. 最悪の条件（600ms遅延、20%パケットロス）でも、カーソルの動きは追跡可能である |

## 6. テスト報告書テンプレート

```
# マウスカーソル表示機能テスト報告書

## テスト概要
- テスト日時: YYYY/MM/DD HH:MM
- テスト環境: [環境の詳細]
- テスター: [名前]

## テスト結果概要
- 実施したテスト数: XX
- 合格したテスト数: XX
- 不合格になったテスト数: XX

## 詳細テスト結果

### [テストID]
- 結果: 合格/不合格
- 観測された動作: [詳細記述]
- 問題点（該当する場合）: [問題の詳細]
- スクリーンショット/録画: [リンク]

### [テストID]
...

## 発見された問題点のサマリー
1. [問題の概要] - 優先度: 高/中/低
2. [問題の概要] - 優先度: 高/中/低
...

## 推奨される改善点
1. [推奨事項]
2. [推奨事項]
...

## 添付資料
- パフォーマンス測定データ
- ユーザービリティ調査結果
- テスト環境の構成詳細
```

## 7. 自動テスト

### 7.1 単体テスト

```rust
#[cfg(test)]
mod tests {
    use super::*;
    
    #[test]
    fn test_mouse_cursor_component_creation() {
        let component = MouseCursorComponent::new(1, "TestPlayer".to_string());
        assert_eq!(component.player_id, 1);
        assert_eq!(component.player_name, "TestPlayer");
        assert_eq!(component.size, 20.0);
        assert!(component.visible);
    }
    
    #[test]
    fn test_color_generation() {
        let color1 = MouseCursorComponent::generate_color(1);
        let color2 = MouseCursorComponent::generate_color(2);
        
        // 同じプレイヤーIDからは常に同じ色が生成される
        assert_eq!(color1, MouseCursorComponent::generate_color(1));
        
        // 異なるプレイヤーIDからは異なる色が生成される
        assert_ne!(color1, color2);
    }
    
    #[test]
    fn test_movement_threshold() {
        let mut component = MouseCursorComponent::new(1, "TestPlayer".to_string());
        component.position = (10.0, 10.0);
        component.last_position = (10.0, 10.0);
        component.movement_threshold = 5.0;
        
        // 閾値以下の移動
        let small_move = (13.0, 13.0);
        let movement_sq = (small_move.0 - component.last_position.0).powi(2) +
                         (small_move.1 - component.last_position.1).powi(2);
        
        // ピタゴラスの定理: √(3² + 3²) = √18 ≈ 4.24 < 5.0
        assert!(movement_sq < component.movement_threshold.powi(2));
        
        // 閾値以上の移動
        let large_move = (16.0, 16.0);
        let movement_sq = (large_move.0 - component.last_position.0).powi(2) +
                         (large_move.1 - component.last_position.1).powi(2);
        
        // ピタゴラスの定理: √(6² + 6²) = √72 ≈ 8.49 > 5.0
        assert!(movement_sq > component.movement_threshold.powi(2));
    }
}
``` 