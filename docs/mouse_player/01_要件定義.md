# マウスカーソル表示機能 要件定義

## 1. 概要

ゲーム内でプレイヤーのマウスカーソル位置を赤い円で表示し、ネットワーク経由で他のプレイヤーにも共有・表示する機能を実装します。これにより、プレイヤー間のコミュニケーションや位置指示が視覚的に可能になります。

## 2. 機能要件

### 2.1 ローカルプレイヤーのマウスカーソル表示

- マウスカーソル位置に赤い円を描画
- 円の大きさは直径20px
- 円の色は赤色（#FF0000）
- 円の透明度は50%（半透明）
- 円の描画はレンダリングレイヤーの最前面に配置

### 2.2 マウスカーソル情報のネットワーク同期

- 自分のマウスカーソル位置をリアルタイムで他のプレイヤーに送信
- ネットワーク更新率は、負荷軽減のため10回/秒（100ミリ秒間隔）
- マウスカーソルデータは軽量に保ち、最小限の情報（位置座標のみ）を送信

### 2.3 他プレイヤーのマウスカーソル表示

- 他のプレイヤーのマウスカーソル位置に円を描画
- 円の大きさは直径20px
- 各プレイヤーの円は異なる色で表示（プレイヤーIDに基づいて自動生成）
- 円の透明度は50%（半透明）
- プレイヤー名をカーソルの横に小さく表示

## 3. 非機能要件

### 3.1 パフォーマンス

- マウスカーソルの描画は軽量に保ち、フレームレートへの影響を最小限にする
- ネットワーク帯域使用量を抑制するため、不要な更新を送信しない
  - マウスが一定以上動いた時のみ更新を送信
  - 無操作状態が続くとカーソル表示の更新頻度を下げる

### 3.2 ユーザビリティ

- マウスカーソル表示のON/OFFを切り替える設定オプションを提供
- マウスカーソルの色や大きさをカスタマイズする設定オプションを提供（将来拡張）

### 3.3 互換性

- すべてのプレイヤーが同じバージョンのクライアントを使用していなくても、
  基本的なマウスカーソル表示機能が動作するよう後方互換性を確保

## 4. 技術要件

### 4.1 データ構造

```rust
/// プレイヤーマウスカーソル情報
#[derive(Serialize, Deserialize, Debug, Clone)]
pub struct MouseCursorData {
    /// プレイヤーID（ネットワーククライアントIDを使用）
    pub player_id: String,
    /// X座標
    pub x: f32,
    /// Y座標
    pub y: f32,
    /// 最終更新時刻（クライアント時間）
    pub timestamp: f64,
    /// 表示するかどうか
    pub visible: bool,
}
```

### 4.2 コンポーネント設計

```rust
/// マウスカーソル表示コンポーネント
pub struct MouseCursorComponent {
    /// カーソルの位置
    pub position: (f32, f32),
    /// カーソルの色
    pub color: String,
    /// カーソルの大きさ
    pub size: f32,
    /// カーソルの透明度
    pub opacity: f32,
    /// 所有プレイヤーID（ネットワーククライアントID）
    pub player_id: String,
    /// プレイヤー名
    pub player_name: String,
    /// 表示するかどうか
    pub visible: bool,
    /// 最終更新時刻
    pub last_update: f64,
    /// 前回の位置
    pub last_position: (f32, f32),
    /// 動きの閾値（この値以上動いたら更新）
    pub movement_threshold: f32,
}
```

### 4.3 メッセージタイプ

```rust
// network/protocol.rsのMessageType列挙型に追加
#[derive(Serialize, Deserialize, Debug, Clone, PartialEq)]
pub enum MessageType {
    // 既存のメッセージタイプ...
    Connect,
    ConnectResponse,
    Disconnect,
    ComponentUpdate,
    EntityCreate,
    EntityDelete,
    InputState,
    Ping,
    Pong,
    Error,
    
    // 追加：マウスカーソル更新
    MouseCursorUpdate,
}
```

## 5. 制約事項

- WebブラウザのマウスカーソルそのものはHTML/CSSで制御されるため、
  ゲーム内での表示は別途Canvas上に描画する必要がある
- マウスカーソルの位置情報は個人情報ではないが、プレイヤーの行動パターンを
  示す情報であるため、必要最小限の用途にのみ使用する
- ローカルプレイヤーのIDはネットワーククライアントIDを使用し、
  グローバルに一意な識別子として機能させる 